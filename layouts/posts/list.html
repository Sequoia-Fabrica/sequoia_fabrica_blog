{{ define "main" }}
<main>
  <header class="page-header">
    <h1>The Solar Blog</h1>
    <p class="page-subtitle">Maker guides, project logs, and community updates from Sequoia Fabrica.</p>
  </header>

  {{ $allposts := where .Site.RegularPages "Type" "in" "posts" }}
  {{ $notunlisted := where .Site.RegularPages ".Params.unlisted" "!=" "true" }}
  {{ $posts := $allposts | intersect $notunlisted }}
  {{ $pages := $posts.ByDate.Reverse }}

  {{/* Featured post - first/most recent */}}
  {{ with index $pages 0 }}
  <article class="post-featured">
    {{ with .Resources.GetMatch "*.{jpg,png,gif}" }}
    <img src="{{ .RelPermalink }}" alt="{{ $.Title }}" class="post-featured-image">
    {{ end }}
    <div class="post-featured-content">
      <h2><a href="{{ .Permalink }}">{{ .Title }}</a></h2>
      {{ with .Summary }}<p class="post-excerpt">{{ . }}</p>{{ end }}
      <div class="post-meta">
        <time>{{ .Date.Format "January 2, 2006" }}</time>
        {{ with .Params.author }}&bull; by {{ . }}{{ end }}
      </div>
    </div>
  </article>
  {{ end }}

  {{/* Remaining posts in grid */}}
  {{ $remaining := after 1 $pages }}
  {{ if gt (len $remaining) 0 }}
  <div class="post-grid">
    {{ range $remaining }}
    <article class="post-card">
      {{ with .Resources.GetMatch "*.{jpg,png,gif}" }}
      <img src="{{ .RelPermalink }}" alt="{{ $.Title }}" class="post-card-image">
      {{ end }}
      <h3><a href="{{ .Permalink }}">{{ .Title }}</a></h3>
      <time>{{ .Date.Format "January 2, 2006" }}</time>
    </article>
    {{ end }}
  </div>
  {{ end }}
</main>
{{ end }}
